<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<meta name="theme-color" content="#000000" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<meta name="apple-mobile-web-app-title" content="Udayana Portal" />
<meta name="mobile-web-app-capable" content="yes" />
<meta name="msapplication-TileColor" content="#000000" />
<meta name="msapplication-tap-highlight" content="no" />
<title>Udayana Lightning Portal</title>
<!-- PWA Icons -->
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">

<style>
  * { 
    margin: 0; 
    padding: 0; 
    box-sizing: border-box; 
    -webkit-tap-highlight-color: transparent;
  }

  html, body {
    height: 100%;
    overflow: hidden;
    touch-action: manipulation;
    background: #000;
  }

  body {
    font-family: "Segoe UI", -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
    min-height: -webkit-fill-available;
    position: relative;
  }

  /* Logo Udayana */
  .udayana-header {
    position: absolute;
    top: 15px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 1000;
    text-align: center;
    width: 100%;
    padding: 0 15px;
  }

  .udayana-logo {
    width: 100px;
    height: 100px;
    filter: drop-shadow(0 0 20px rgba(255, 215, 0, 0.5))
           drop-shadow(0 0 40px rgba(255, 140, 0, 0.3));
    transition: all 0.5s ease;
    animation: goldenPulse 3s infinite alternate;
  }

  @keyframes goldenPulse {
    0% { 
      transform: scale(1);
      filter: drop-shadow(0 0 15px rgba(255, 215, 0, 0.4))
             drop-shadow(0 0 30px rgba(255, 140, 0, 0.2));
    }
    100% { 
      transform: scale(1.05);
      filter: drop-shadow(0 0 25px rgba(255, 215, 0, 0.6))
             drop-shadow(0 0 50px rgba(255, 140, 0, 0.4));
    }
  }

  .udayana-title {
    color: #ffd700;
    font-size: 22px;
    font-weight: bold;
    margin-top: 8px;
    text-shadow: 0 0 15px rgba(255, 215, 0, 0.7),
                 0 0 25px rgba(255, 140, 0, 0.4);
    letter-spacing: 2px;
  }

  /* Responsif untuk layar kecil */
  @media (max-width: 768px) {
    .udayana-logo {
      width: 80px;
      height: 80px;
    }
    
    .udayana-title {
      font-size: 18px;
    }
  }

  @media (max-width: 480px) {
    .udayana-logo {
      width: 70px;
      height: 70px;
    }
    
    .udayana-title {
      font-size: 16px;
      letter-spacing: 1px;
    }
  }

  /* Container utama */
  .main-container {
    width: 100%;
    height: 100vh;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 140px 20px 20px;
    position: relative;
    overflow-y: auto;
    overflow-x: hidden;
  }

  /* Scrollbar styling */
  .main-container::-webkit-scrollbar {
    width: 8px;
  }

  .main-container::-webkit-scrollbar-track {
    background: rgba(255, 215, 0, 0.1);
    border-radius: 4px;
  }

  .main-container::-webkit-scrollbar-thumb {
    background: rgba(255, 215, 0, 0.3);
    border-radius: 4px;
  }

  .main-container::-webkit-scrollbar-thumb:hover {
    background: rgba(255, 215, 0, 0.5);
  }

  /* Grid untuk tombol - 3 kolom */
  .buttons-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 18px;
    width: 100%;
    max-width: 1000px;
    margin-top: 20px;
    z-index: 10;
    padding-bottom: 20px;
  }

  /* Responsif grid */
  @media (max-width: 1024px) {
    .buttons-grid {
      max-width: 800px;
      gap: 16px;
    }
  }

  @media (max-width: 768px) {
    .buttons-grid {
      gap: 14px;
      max-width: 600px;
      grid-template-columns: repeat(3, 1fr);
    }
  }

  @media (max-width: 480px) {
    .buttons-grid {
      gap: 12px;
      grid-template-columns: repeat(3, 1fr);
    }
    
    .main-container {
      padding: 120px 15px 15px;
    }
  }

  /* Landscape mode */
  @media (max-height: 700px) and (orientation: landscape) {
    .main-container {
      padding: 100px 10px 10px;
      justify-content: flex-start;
    }
    
    .buttons-grid {
      gap: 10px;
      max-width: 95%;
      margin-top: 10px;
    }
    
    .udayana-header {
      top: 10px;
    }
    
    .udayana-logo {
      width: 60px;
      height: 60px;
    }
  }

  /* Tombol dengan logo tanpa background */
  .portal-button {
    position: relative;
    cursor: pointer;
    border: none;
    background: transparent;
    overflow: visible;
    transition: all 0.3s ease;
    z-index: 10;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 130px;
    aspect-ratio: 1/1;
    text-align: center;
  }

  /* Tombol disabled sementara */
  .portal-button:disabled {
    cursor: not-allowed;
    opacity: 0.7;
  }

  /* Container logo untuk efek khusus */
  .logo-container {
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    border-radius: 15px;
    background: rgba(0, 0, 0, 0.3);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border: 2px solid rgba(255, 255, 255, 0.1);
    transition: all 0.3s ease;
    overflow: hidden;
    position: relative;
  }

  .portal-button:hover:not(:disabled) .logo-container { 
    transform: translateY(-5px) scale(1.08); 
    filter: brightness(1.4);
    box-shadow: 0 20px 45px rgba(0, 0, 0, 0.8),
                0 0 30px currentColor,
                inset 0 0 25px rgba(255, 255, 255, 0.1);
    border-color: rgba(255, 255, 255, 0.3);
  }

  .portal-button:active:not(:disabled) .logo-container {
    transform: translateY(-2px) scale(1.02);
    transition: 0.1s;
  }

  /* Logo di dalam tombol */
  .button-logo {
    width: 65px;
    height: 65px;
    object-fit: contain;
    margin-bottom: 8px;
    transition: all 0.3s ease;
    filter: drop-shadow(0 0 10px currentColor);
  }

  /* Logo khusus untuk masing-masing tombol */
  #btn1 .button-logo {
    filter: drop-shadow(0 0 15px rgba(0, 180, 255, 0.8));
  }

  #btn2 .button-logo {
    filter: drop-shadow(0 0 15px rgba(200, 0, 255, 0.8));
  }

  #btn7 .button-logo {
    filter: drop-shadow(0 0 15px rgba(255, 100, 100, 0.8));
  }

  #btn8 .button-logo {
    filter: drop-shadow(0 0 15px rgba(100, 255, 200, 0.8));
  }

  #btn3 .button-logo,
  #btn4 .button-logo,
  #btn5 .button-logo,
  #btn6 .button-logo {
    filter: drop-shadow(0 0 15px rgba(255, 255, 255, 0.6));
  }

  .portal-button:hover:not(:disabled) .button-logo {
    transform: scale(1.1);
    filter: drop-shadow(0 0 20px currentColor) brightness(1.3);
  }

  .button-text {
    font-size: 13px;
    font-weight: bold;
    line-height: 1.3;
    color: white;
    text-transform: uppercase;
    letter-spacing: 1.2px;
    text-shadow: 0 0 10px currentColor;
    margin-top: 5px;
    padding: 0 5px;
    text-align: center;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  @media (max-width: 768px) {
    .portal-button {
      min-height: 110px;
    }
    
    .logo-container {
      border-radius: 12px;
    }
    
    .button-logo {
      width: 55px;
      height: 55px;
    }
    
    .button-text {
      font-size: 11px;
      letter-spacing: 1px;
      -webkit-line-clamp: 2;
    }
  }

  @media (max-width: 480px) {
    .portal-button {
      min-height: 100px;
    }
    
    .button-logo {
      width: 45px;
      height: 45px;
    }
    
    .button-text {
      font-size: 10px;
      -webkit-line-clamp: 2;
    }
  }

  /* Canvas untuk efek hujan dan petir */
  canvas {
    position: fixed;
    inset: 0;
    z-index: 1;
    width: 100%;
    height: 100%;
    pointer-events: none;
  }

  .flash-overlay {
    position: fixed;
    inset: 0;
    background: white;
    opacity: 0;
    pointer-events: none;
    z-index: 2;
    transition: opacity 0.05s;
  }

  /* Efek pecah seribu */
  .shard {
    position: absolute;
    border-radius: 50%;
    pointer-events: none;
    background: radial-gradient(circle at 30% 30%, currentColor, transparent);
    box-shadow: 0 0 15px currentColor;
    transform-origin: center;
    z-index: 100;
    opacity: 0;
  }

  .spark {
    position: absolute;
    border-radius: 50%;
    pointer-events: none;
    background: radial-gradient(circle, white, transparent);
    box-shadow: 0 0 20px white,
                0 0 40px currentColor;
    z-index: 99;
    opacity: 0;
  }

  /* Control buttons */
  .control-buttons {
    position: fixed;
    bottom: 20px;
    right: 20px;
    display: flex;
    gap: 12px;
    z-index: 1000;
  }

  .control-btn {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    background: rgba(255, 215, 0, 0.25);
    border: 2px solid rgba(255, 215, 0, 0.6);
    color: white;
    font-size: 20px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    transition: all 0.3s ease;
  }

  .control-btn:hover {
    transform: scale(1.1);
    background: rgba(255, 215, 0, 0.4);
  }

  /* Loading overlay */
  .loading-overlay {
    position: fixed;
    inset: 0;
    background: #000;
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    flex-direction: column;
    gap: 25px;
  }

  .loading-overlay.hidden {
    display: none;
  }

  .loading-logo {
    width: 120px;
    height: 120px;
    filter: drop-shadow(0 0 30px rgba(255, 215, 0, 0.8));
  }

  .loading-text {
    color: #ffd700;
    font-size: 24px;
    font-weight: bold;
    text-align: center;
    animation: pulse 1.5s infinite;
    text-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
  }

  /* Status bar untuk efek loading */
  .status-bar {
    width: 200px;
    height: 4px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 2px;
    overflow: hidden;
    margin-top: 10px;
  }

  .status-progress {
    width: 0%;
    height: 100%;
    background: linear-gradient(90deg, #ffd700, #ff8c00);
    border-radius: 2px;
    transition: width 0.3s ease;
  }
</style>
</head>

<body>
<!-- Loading overlay -->
<div class="loading-overlay" id="loadingOverlay">
  <img src="https://upload.wikimedia.org/wikipedia/commons/2/25/Lambang_Kodam_Udayana.svg" 
       alt="Udayana" class="loading-logo">
  <div class="loading-text">‚ö° UDAYANA PORTAL ‚ö°</div>
  <div class="status-bar">
    <div class="status-progress" id="statusProgress"></div>
  </div>
</div>

<!-- Header dengan logo Udayana -->
<div class="udayana-header">
  <img src="https://upload.wikimedia.org/wikipedia/commons/2/25/Lambang_Kodam_Udayana.svg" 
       alt="Lambang Kodam Udayana" class="udayana-logo">
  <div class="udayana-title">UDAYANA PORTAL</div>
</div>

<!-- Control buttons -->
<div class="control-buttons">
  <button class="control-btn" id="infoBtn" title="Info">‚ìò</button>
  <button class="control-btn" id="fullscreenBtn" title="Fullscreen">‚õ∂</button>
</div>

<!-- Canvas untuk efek hujan dan petir -->
<canvas id="stormCanvas"></canvas>
<div class="flash-overlay" id="stormFlash"></div>

<!-- Main container dengan grid tombol -->
<div class="main-container">
  <div class="buttons-grid">
    <button class="portal-button" id="btn1">
      <div class="logo-container">
        <img src="https://upload.wikimedia.org/wikipedia/commons/2/25/Lambang_Kodam_Udayana.svg" 
             alt="DUKOPS" class="button-logo">
        <span class="button-text">DUKOPS</span>
      </div>
    </button>
    <button class="portal-button" id="btn2">
      <div class="logo-container">
        <img src="https://raw.githubusercontent.com/Koramil05/JADWAL/main/LOGO%20KOREM163%20Wirasatya.png" 
             alt="LPST05" class="button-logo">
        <span class="button-text">LPST05</span>
      </div>
    </button>
    <button class="portal-button" id="btn3">
      <div class="logo-container">
        <span class="button-logo" style="font-size: 45px;">üìÅ</span>
        <span class="button-text">GOOGLE DRIVE</span>
      </div>
    </button>
    <button class="portal-button" id="btn4">
      <div class="logo-container">
        <span class="button-logo" style="font-size: 45px;">üìä</span>
        <span class="button-text">SPREADSHEET</span>
      </div>
    </button>
    <button class="portal-button" id="btn5">
      <div class="logo-container">
        <span class="button-logo" style="font-size: 45px;">üõí</span>
        <span class="button-text">PLAY STORE</span>
      </div>
    </button>
    <button class="portal-button" id="btn6">
      <div class="logo-container">
        <span class="button-logo" style="font-size: 45px;">‚úàÔ∏è</span>
        <span class="button-text">TELEGRAM</span>
      </div>
    </button>
    <!-- Tombol baru untuk Pemetaan Lahan -->
    <button class="portal-button" id="btn7">
      <div class="logo-container">
        <span class="button-logo" style="font-size: 45px;">üó∫Ô∏è</span>
        <span class="button-text">PEMETAAN LAHAN</span>
      </div>
    </button>
    <!-- Tombol baru untuk Portal KD KMP -->
    <button class="portal-button" id="btn8">
      <div class="logo-container">
        <span class="button-logo" style="font-size: 45px;">üåê</span>
        <span class="button-text">PORTAL KD KMP</span>
      </div>
    </button>
  </div>
</div>

<script>
// Inisialisasi variabel global
const canvas = document.getElementById("stormCanvas");
const ctx = canvas.getContext("2d");
const flashOverlay = document.getElementById("stormFlash");
const loadingOverlay = document.getElementById("loadingOverlay");
const statusProgress = document.getElementById("statusProgress");
let w = 0, h = 0;

// Resize canvas
function resizeCanvas() {
  w = canvas.width = window.innerWidth;
  h = canvas.height = window.innerHeight;
}
window.addEventListener("resize", resizeCanvas);
resizeCanvas();

// ============================
// LOADING ANIMATION
// ============================
function updateLoadingProgress(percent) {
  statusProgress.style.width = `${percent}%`;
}

// ============================
// EFEK HUJAN GERIMIS (SEPERTI AWAL)
// ============================
const rainDrops = [];
const rainCount = 400;

function initRain() {
  rainDrops.length = 0;
  for (let i = 0; i < rainCount; i++) {
    rainDrops.push({
      x: Math.random() * w,
      y: Math.random() * h,
      length: Math.random() * 25 + 15,
      speed: Math.random() * 8 + 5,
      thickness: Math.random() * 1.5 + 0.5,
      opacity: Math.random() * 0.3 + 0.1
    });
  }
}

function drawRain() {
  // Background gradient gelap dengan sentuhan biru malam
  const gradient = ctx.createLinearGradient(0, 0, 0, h);
  gradient.addColorStop(0, "#0a1525");
  gradient.addColorStop(0.5, "#071121");
  gradient.addColorStop(1, "#050a15");
  ctx.fillStyle = gradient;
  ctx.fillRect(0, 0, w, h);
  
  // Gambar setiap tetesan hujan
  ctx.strokeStyle = "rgba(180, 200, 255, 0.2)";
  ctx.lineCap = "round";
  
  for (let drop of rainDrops) {
    // Warna dengan opacity berbeda
    ctx.strokeStyle = `rgba(180, 200, 255, ${drop.opacity})`;
    ctx.lineWidth = drop.thickness;
    
    ctx.beginPath();
    ctx.moveTo(drop.x, drop.y);
    ctx.lineTo(drop.x + drop.length * 0.3, drop.y + drop.length);
    
    // Tambahkan efek blur/glow untuk tetesan
    ctx.shadowBlur = 3;
    ctx.shadowColor = "rgba(150, 180, 255, 0.3)";
    ctx.stroke();
    ctx.shadowBlur = 0;
    
    // Update posisi tetesan
    drop.y += drop.speed;
    drop.x += 0.8;
    
    // Jika tetesan mencapai bawah, reset ke atas
    if (drop.y > h) {
      drop.y = -drop.length;
      drop.x = Math.random() * w;
    }
    
    // Jika tetesan keluar dari kanan, reset ke kiri
    if (drop.x > w) {
      drop.x = 0;
    }
  }
  
  // Tambahkan efek kabut/awan tipis di background
  for (let i = 0; i < 3; i++) {
    const fogX = (w / 3) * i + Math.sin(Date.now() * 0.0001 + i) * 50;
    const fogY = h * 0.7;
    const fogRadius = w * 0.4;
    
    const fogGradient = ctx.createRadialGradient(
      fogX, fogY, 0,
      fogX, fogY, fogRadius
    );
    fogGradient.addColorStop(0, "rgba(30, 40, 60, 0.05)");
    fogGradient.addColorStop(1, "rgba(30, 40, 60, 0)");
    
    ctx.fillStyle = fogGradient;
    ctx.beginPath();
    ctx.arc(fogX, fogY, fogRadius, 0, Math.PI * 2);
    ctx.fill();
  }
}

// ============================
// EFEK PECAH SERIBU
// ============================
function createThousandShards(button, color) {
  const rect = button.getBoundingClientRect();
  const centerX = rect.left + rect.width / 2;
  const centerY = rect.top + rect.height / 2;
  
  // Simpan logo container asli
  const logoContainer = button.querySelector('.logo-container');
  const originalOpacity = logoContainer.style.opacity;
  const originalTransform = logoContainer.style.transform;
  
  // Sembunyikan logo container sementara
  logoContainer.style.opacity = '0.3';
  logoContainer.style.transform = 'scale(0.8)';
  
  // Warna berdasarkan tombol
  const colorMap = {
    'btn1': 'rgba(0, 180, 255, 1)',
    'btn2': 'rgba(200, 0, 255, 1)',
    'btn3': 'rgba(255, 220, 80, 1)',
    'btn4': 'rgba(100, 255, 100, 1)',
    'btn5': 'rgba(100, 180, 255, 1)',
    'btn6': 'rgba(0, 220, 255, 1)',
    'btn7': 'rgba(255, 100, 100, 1)',    // Merah untuk Pemetaan Lahan
    'btn8': 'rgba(100, 255, 200, 1)'     // Cyan untuk Portal KD KMP
  };
  
  const shardColor = colorMap[button.id] || 'rgba(255, 215, 0, 1)';
  
  // Buat 1200 shards
  for (let i = 0; i < 1200; i++) {
    const shard = document.createElement('div');
    shard.className = 'shard';
    
    // Ukuran random dengan berbagai ukuran
    const size = Math.random() * 12 + 3;
    shard.style.width = `${size}px`;
    shard.style.height = `${size}px`;
    
    // Warna dengan opacity bervariasi
    shard.style.color = shardColor;
    shard.style.opacity = Math.random() * 0.8 + 0.2;
    
    // Posisi awal dari tengah tombol
    shard.style.left = `${centerX}px`;
    shard.style.top = `${centerY}px`;
    
    // Gerakan random dengan variasi
    const angle = Math.random() * Math.PI * 2;
    const distance = Math.random() * 350 + 150;
    const rotation = Math.random() * 720;
    
    // Animasi
    shard.animate([
      {
        transform: 'translate(0, 0) rotate(0deg) scale(1)',
        opacity: 1
      },
      {
        transform: `translate(${Math.cos(angle) * distance}px, ${Math.sin(angle) * distance}px) rotate(${rotation}deg) scale(0)`,
        opacity: 0
      }
    ], {
      duration: 1000 + Math.random() * 800,
      easing: 'cubic-bezier(0.2, 0.8, 0.3, 1)',
      fill: 'forwards',
      delay: Math.random() * 200
    });
    
    document.body.appendChild(shard);
    
    // Hapus shard setelah animasi
    setTimeout(() => shard.remove(), 1800);
  }
  
  // Buat 600 sparks
  for (let i = 0; i < 600; i++) {
    const spark = document.createElement('div');
    spark.className = 'spark';
    
    // Ukuran spark bervariasi
    const sparkSize = Math.random() * 10 + 3;
    spark.style.width = `${sparkSize}px`;
    spark.style.height = `${sparkSize}px`;
    
    // Warna spark
    spark.style.color = shardColor;
    spark.style.opacity = Math.random() * 0.9 + 0.1;
    
    spark.style.left = `${centerX}px`;
    spark.style.top = `${centerY}px`;
    
    const angle = Math.random() * Math.PI * 2;
    const distance = Math.random() * 300 + 100;
    
    spark.animate([
      {
        transform: 'translate(0, 0) scale(1)',
        opacity: 1,
        filter: 'blur(0px)'
      },
      {
        transform: `translate(${Math.cos(angle) * distance}px, ${Math.sin(angle) * distance}px) scale(0)`,
        opacity: 0,
        filter: 'blur(5px)'
      }
    ], {
      duration: 700 + Math.random() * 500,
      easing: 'cubic-bezier(0.1, 0.9, 0.2, 1)',
      fill: 'forwards',
      delay: Math.random() * 150
    });
    
    document.body.appendChild(spark);
    setTimeout(() => spark.remove(), 1200);
  }
  
  // Kembalikan logo container setelah 1.2 detik dengan efek
  setTimeout(() => {
    logoContainer.animate([
      { opacity: 0.3, transform: 'scale(0.8) rotate(-10deg)' },
      { opacity: 1, transform: 'scale(1.1) rotate(5deg)' },
      { opacity: 1, transform: 'scale(1) rotate(0deg)' }
    ], {
      duration: 600,
      easing: 'cubic-bezier(0.34, 1.56, 0.64, 1)'
    });
    
    // Set style setelah animasi
    setTimeout(() => {
      logoContainer.style.opacity = originalOpacity;
      logoContainer.style.transform = originalTransform;
    }, 600);
  }, 1200);
}

// ============================
// HANDLER TOMBOL (Sekarang 8 tombol)
// ============================
const buttonConfigs = {
  btn1: { 
    url: "https://koramil05.github.io/DUKOPS/", 
    name: "DUKOPS" 
  },
  btn2: { 
    url: "https://koramil05.github.io/LPST05/", 
    name: "LPST05" 
  },
  btn3: { 
    url: "https://drive.google.com/drive/folders/1K9iWrM9fGU3sMcEZCmUWIbx0rLs285_x", 
    name: "GOOGLE DRIVE" 
  },
  btn4: { 
    url: "https://docs.google.com/spreadsheets", 
    name: "SPREADSHEET" 
  },
  btn5: { 
    url: "market://details?id=com.android.vending",
    fallback: "https://play.google.com/store",
    name: "PLAY STORE" 
  },
  btn6: { 
    url: "tg://resolve?domain=telegram",
    fallback: "https://t.me/telegram",
    name: "TELEGRAM" 
  },
  btn7: { 
    url: "https://pemetaan-lahan.portalkdkmp.id",
    name: "PEMETAAN LAHAN" 
  },
  btn8: { 
    url: "https://portalkdkmp.id/",
    name: "PORTAL KD KMP" 
  }
};

// Setup semua tombol
Object.keys(buttonConfigs).forEach(btnId => {
  const button = document.getElementById(btnId);
  const config = buttonConfigs[btnId];
  
  button.addEventListener('click', async (e) => {
    // Nonaktifkan tombol sementara
    button.disabled = true;
    
    // Efek visual tombol saat diklik
    const logoContainer = button.querySelector('.logo-container');
    const originalTransform = logoContainer.style.transform;
    logoContainer.style.transform = 'scale(0.9)';
    logoContainer.style.filter = 'brightness(1.5) saturate(2)';
    
    // Efek pecah seribu
    createThousandShards(button, btnId);
    
    // Tunggu 1.5 detik untuk semua animasi
    await new Promise(resolve => setTimeout(resolve, 1500));
    
    // Kembalikan tombol ke semula
    logoContainer.style.transform = originalTransform;
    logoContainer.style.filter = '';
    
    // Buka link
    setTimeout(() => {
      if (config.fallback) {
        const appWindow = window.open(config.url, '_blank');
        setTimeout(() => {
          if (!appWindow || appWindow.closed || typeof appWindow.closed === 'undefined') {
            window.open(config.fallback, '_blank');
          }
        }, 500);
      } else {
        window.open(config.url, '_blank');
      }
      
      // Aktifkan kembali tombol setelah 500ms
      setTimeout(() => {
        button.disabled = false;
      }, 500);
    }, 200);
  });
});

// ============================
// CONTROL BUTTONS
// ============================
document.getElementById('infoBtn').addEventListener('click', () => {
  alert('üõ°Ô∏è UDAYANA PORTAL üõ°Ô∏è\n\nPortal Akses Cepat Kodam Udayana:\n\n‚Ä¢ DUKOPS - Website Resmi\n‚Ä¢ LPST05 - Website Resmi\n‚Ä¢ Google Drive - Folder Dokumentasi\n‚Ä¢ Spreadsheet - Laporan Digital\n‚Ä¢ Play Store - Aplikasi Android\n‚Ä¢ Telegram - Komunikasi Tim\n‚Ä¢ Pemetaan Lahan - Sistem Pemetaan\n‚Ä¢ Portal KD KMP - Website Utama\n\nKlik tombol untuk efek spektakuler!');
});

document.getElementById('fullscreenBtn').addEventListener('click', () => {
  if (!document.fullscreenElement) {
    document.documentElement.requestFullscreen();
    document.getElementById('fullscreenBtn').textContent = '‚úï';
  } else {
    document.exitFullscreen();
    document.getElementById('fullscreenBtn').textContent = '‚õ∂';
  }
});

// ============================
// PWA SETUP UNTUK GITHUB PAGES
// ============================
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    const swCode = `
      self.addEventListener('install', (e) => {
        console.log('[Service Worker] Installing Udayana Portal');
        self.skipWaiting();
      });
      
      self.addEventListener('activate', (e) => {
        console.log('[Service Worker] Activating Udayana Portal');
        e.waitUntil(clients.claim());
      });
      
      self.addEventListener('fetch', (e) => {
        e.respondWith(
          fetch(e.request).catch(() => {
            return new Response('Udayana Portal - Offline Mode', {
              status: 200,
              headers: { 'Content-Type': 'text/html' }
            });
          })
        );
      });
    `;
    
    const blob = new Blob([swCode], { type: 'application/javascript' });
    const swUrl = URL.createObjectURL(blob);
    
    navigator.serviceWorker.register(swUrl)
      .then(reg => {
        console.log('Service Worker registered for scope:', reg.scope);
        
        // Cek update setiap jam
        setInterval(() => {
          reg.update();
        }, 3600000);
      })
      .catch(err => console.log('Service Worker registration failed:', err));
  });
}

// Create manifest untuk PWA
const manifest = {
  "name": "Udayana Portal",
  "short_name": "Udayana",
  "description": "Portal Akses Cepat Kodam Udayana dengan Efek Visual Spektakuler",
  "start_url": ".",
  "display": "standalone",
  "background_color": "#000000",
  "theme_color": "#ffd700",
  "orientation": "portrait",
  "icons": [
    {
      "src": "https://upload.wikimedia.org/wikipedia/commons/2/25/Lambang_Kodam_Udayana.svg",
      "sizes": "192x192 512x512",
      "type": "image/svg+xml",
      "purpose": "any maskable"
    }
  ],
  "categories": ["productivity", "utilities"],
  "lang": "id",
  "dir": "ltr"
};

// Inject manifest secara dinamis
const manifestElement = document.createElement('link');
manifestElement.rel = 'manifest';
manifestElement.href = 'data:application/manifest+json,' + encodeURIComponent(JSON.stringify(manifest));
document.head.appendChild(manifestElement);

// Handle PWA installation
let deferredPrompt;
window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();
  deferredPrompt = e;
  
  // Tampilkan notifikasi install setelah 5 detik
  setTimeout(() => {
    if (window.matchMedia('(display-mode: standalone)').matches) return;
    
    const installBtn = document.createElement('button');
    installBtn.textContent = 'üì≤ Install App';
    installBtn.style.cssText = `
      position: fixed;
      bottom: 80px;
      right: 20px;
      padding: 12px 20px;
      background: linear-gradient(145deg, rgba(255, 215, 0, 0.9), rgba(255, 140, 0, 0.9));
      color: black;
      border: none;
      border-radius: 25px;
      font-weight: bold;
      font-size: 14px;
      cursor: pointer;
      z-index: 10000;
      backdrop-filter: blur(10px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.5);
      transition: all 0.3s ease;
    `;
    
    installBtn.onmouseover = () => installBtn.style.transform = 'scale(1.1)';
    installBtn.onmouseout = () => installBtn.style.transform = 'scale(1)';
    
    installBtn.onclick = async () => {
      if (deferredPrompt) {
        deferredPrompt.prompt();
        const { outcome } = await deferredPrompt.userChoice;
        if (outcome === 'accepted') {
          console.log('User accepted PWA installation');
          installBtn.remove();
        }
        deferredPrompt = null;
      }
    };
    
    document.body.appendChild(installBtn);
    
    // Auto remove setelah 15 detik
    setTimeout(() => {
      if (installBtn.parentNode) {
        installBtn.style.opacity = '0';
        installBtn.style.transform = 'translateY(20px)';
        setTimeout(() => installBtn.remove(), 300);
      }
    }, 15000);
  }, 5000);
});

// ============================
// INITIALIZE
// ============================
function initialize() {
  // Update loading progress
  let progress = 0;
  const loadingInterval = setInterval(() => {
    progress += Math.random() * 15 + 5;
    if (progress > 100) progress = 100;
    updateLoadingProgress(progress);
    
    if (progress >= 100) {
      clearInterval(loadingInterval);
      initRain();
      
      // Animasi utama - HANYA HUJAN
      function animate() {
        drawRain();
        requestAnimationFrame(animate);
      }
      animate();
      
      // Sembunyikan loading
      setTimeout(() => {
        loadingOverlay.style.opacity = '0';
        loadingOverlay.style.transform = 'scale(1.1)';
        setTimeout(() => {
          loadingOverlay.classList.add('hidden');
        }, 500);
      }, 800);
    }
  }, 100);
}

// Start everything
window.addEventListener('load', initialize);

// Handle orientation change
window.addEventListener('orientationchange', () => {
  setTimeout(() => {
    resizeCanvas();
    initRain();
  }, 300);
});

// Handle app install event
window.addEventListener('appinstalled', () => {
  console.log('PWA was successfully installed');
  
  // Tampilkan pesan selamat datang
  setTimeout(() => {
    alert('üéâ Udayana Portal Berhasil Diinstall!\n\nAplikasi sekarang tersedia di perangkat Anda. Terima kasih!');
  }, 1000);
});
</script>
</body>
</html>
